apiVersion: v1
kind: ConfigMap
metadata:
  name: atlan-connectors-NAME
  labels:
    orchestration.atlan.com/version: "1"
    orchestration.atlan.com/source: "NAME"
data:
  icon: "https://atlan-public.s3.eu-west-1.amazonaws.com/atlan/logos/aws-NAME.png"
  helpdeskLink: "https://ask.atlan.com/hc/en-us/articles/4605882724369-How-to-set-up-your-NAME-connection-on-Atlan"
  logo: "https://atlan-public.s3.eu-west-1.amazonaws.com/atlan/logos/aws-NAME.png"
  connector: "NAME"
  defaultConnectorType: "sdk"
  jdbcCredentialTemplate: "{}"
  restCredentialTemplate: "{}"
  odbcCredentialTemplate: "{}"
  grpcCredentialTemplate: "{}"
  restMetadataTemplate: ""
  restMetadataOutputTransformerTemplate: ""
  sdkCredentialTemplate: |
    [
      {
          "id": 1,
          "name": "<>",
          "source": "AWS",
          "action": "AWSNAME.<>",
          "params": { {% if authType == "iam" %} "aws_access_key_id": "{{username}}", "aws_secret_access_key": "{{password}}", {% endif %} "region": "{{extra.region}}" {% if authType == "role" and extra.aws_role_arn|length %}, "aws_role_arn": "{{extra.aws_role_arn}}" {% endif %} {% if authType == "role" and extra.aws_external_id|length %}, "aws_external_id": "{{extra.aws_external_id}}" {% endif %} }
      }
    ]
  config: |
    {
      "properties": {
        "name": {
          "type": "string",
          "required": false,
          "ui": {
            "label": "Name",
            "hidden": true,
            "placeholder": "Credential Name"
          }
        },
        "connector": {
          "type": "string",
          "required": false,
          "ui": {
            "label": "Connector",
            "hidden": true,
            "placeholder": "Connector"
          }
        },
        "connectorType": {
          "type": "string",
          "required": false,
          "ui": {
            "key": "_host",
            "label": "connectorType",
            "placeholder": "connectorType",
            "hidden": true
          }
        },
        "auth-type": {
          "type": "string",
          "enum": [
            "iam",
            "role"
          ],
          "default": "iam",
          "required": true,
          "enumNames": [
            "IAM User",
            "IAM Role"
          ],
          "ui": {
            "widget": "radio",
            "hidden": false,
            "label": "Authentication",
            "placeholder": "Credential Type",
            "rules": [
              {
                "required": true,
                "message": "Please enter a valid authentication type"
              }
            ]
          }
        },
        "port": {
          "type": "number",
          "default": 443,
          "required": false,
          "ui": {
            "label": "Port",
            "hidden": true,
            "placeholder": "Port"
          }
        },
        "iam": {
          "type": "object",
          "properties": {
            "username": {
              "type": "string",
              "required": true,
              "ui": {
                "label": "AWS Access Key",
                "placeholder": "Access Key",
                "feedback": true,
                "help": "AWS Access Key",
                "message": "Please enter a valid Access Key",
                "grid": 4,
                "rules": [
                  {
                    "required": true,
                    "message": "Please enter a valid Access Key"
                  }
                ]
              }
            },
            "password": {
              "type": "string",
              "required": true,
              "ui": {
                "widget": "password",
                "label": "AWS Secret Key",
                "feedback": true,
                "help": "AWS Secret Key",
                "placeholder": "Secret Key",
                "grid": 4,
                "rules": [
                  {
                    "required": true,
                    "message": "Please enter a valid Secret Key"
                  }
                ]
              }
            }
          },
          "ui": {
            "widget": "nested",
            "label": "",
            "placeholder": "Credential Type",
            "nestedValue": false,
            "hidden": false
          }
        },
        "role":{
          "type": "object",
          "properties": {
            "extra": {
              "type": "object",
              "properties": {
                "aws_role_arn": {
                  "type": "string",
                  "required": false,
                  "ui": {
                    "label": "AWS Role ARN",
                    "hidden": false,
                    "placeholder": "arn:aws:iam::123456789012:role/roleName",
                    "help": "AWS role to assume for the connection",
                    "grid": 4,
                    "rules": [
                      {
                        "pattern": "^arn:aws:iam::\\d{12}:role/.+",
                        "message": "Please enter a valid role ARN",
                        "trigger": "blur"
                      }
                    ]
                  }
                },
                "aws_external_id": {
                  "type": "string",
                  "required": false,
                  "ui": {
                      "label": "External ID",
                      "widget": "keygen",
                      "help": "Unique external ID to enable access of your AWS resources to Atlan"
                  }
                }
              },
              "ui": {
                "widget": "nested",
                "label": "",
                "header": "Advanced",
                "hidden": false
              }
            }
          },
          "ui": {
            "widget": "nested",
            "label": "",
            "placeholder": "Credential Type",
            "nestedValue": false,
            "hidden": true
          }
        },
        "extra": {
          "type": "object",
          "properties": {
            "region": {
              "type": "string",
              "required": true,
              "default": "",
              "ui": {
                "help": "Enter region of NAME setup",
                "label": "Region",
                "hidden": false,
                "placeholder": "us-west-1",
                "grid": 4,
                "rules": [
                  {
                    "required": true,
                    "message": "Please enter a region"
                  }
                ]
              }
            }
          },
          "ui": {
            "widget": "nested",
            "label": "",
            "header": "Advanced",
            "hidden": false
          }
        }
      },
      "anyOf": [
        {
          "properties": {
            "auth-type": {
              "const": "iam"
            }
          },
          "required": [
            "iam"
          ]
        },
        {
          "properties": {
            "auth-type": {
              "const": "role"
            }
          },
          "required": ["role"]
        }
      ]
    }
